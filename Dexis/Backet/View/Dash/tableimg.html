<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div class="contentpanel">
    <if condition="session('admin_info')['groups'] neq '1'">
        <div class="row">
            <div class="col-sm-6 col-md-6">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-sm-12">
                                <h5 class="subtitle mb5">各个等级的会员数量</h5>
                                <div id="member-number"  style="width: 100%; height: 350px"></div>
                            </div><!-- col-sm-8 -->

                        </div><!-- row -->
                    </div><!-- panel-body -->
                </div><!-- panel -->
            </div><!-- col-sm-9 -->

            <div class="col-sm-6 col-md-6">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <h5 class="subtitle mb5">各个等级7天变动</h5>
                        <!--<p class="mb15"><br/></p>-->
                        <div id="line-member-change" style="width: 100%;height: 350px"></div>
                    </div><!-- panel-body -->
                </div><!-- panel -->
            </div><!-- col-sm-3 -->

            <div class="col-sm-6 col-md-6">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <h5 class="subtitle mb5">每个级别今日的出货数据</h5>
                        <!--<p class="mb15"><br/></p>-->
                        <div id="goods-number" style="width: 100%;height: 350px"></div>
                    </div><!-- panel-body -->
                </div><!-- panel -->
            </div><!-- col-sm-3 -->
            <div class="col-sm-6 col-md-6">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <h5 class="subtitle mb5">每个级别今日的进货数据</h5>
                        <!--<p class="mb15"><br/></p>-->
                        <div id="goods-number-in" style="width: 100%;height: 350px"></div>
                    </div><!-- panel-body -->
                </div><!-- panel -->
            </div><!-- col-sm-3 -->

            <div class="col-sm-12 col-md-12">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <h5 class="subtitle mb5">按月会员等级变动</h5>
                        <!--<p class="mb15"><br/></p>-->
                        <div id="memberNumberWeek" style="width: 100%;height: 350px"></div>
                    </div><!-- panel-body -->
                </div><!-- panel -->
            </div><!-- col-sm-3 -->

            <div class="col-sm-12 col-md-12">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <h5 class="subtitle mb5">本月每天会员等级变动</h5>
                        <!--<p class="mb15"><br/></p>-->
                        <div id="memberNumberDay" style="width: 100%;height: 350px"></div>
                    </div><!-- panel-body -->
                </div><!-- panel -->
            </div><!-- col-sm-3 -->
        </div>
    </if>
</div>
<script src="__PUBLIC__/backet/js/echarts.common.min.js"></script>

<script type="text/javascript">
    window.addEventListener("resize", function () {
        option.chart.resize();

    });
    var memberNumber = echarts.init(document.getElementById('member-number'));
    var numberChange = echarts.init(document.getElementById('line-member-change'));
    var goodsDayOut = echarts.init(document.getElementById('goods-number'));
    var goodsDayIn = echarts.init(document.getElementById('goods-number-in'));

    var memberNumberWeek = echarts.init(document.getElementById('memberNumberWeek'));
    var memberNumberDay = echarts.init(document.getElementById('memberNumberDay'));

    memberNumber.setOption({
        tooltip: {
            trigger: 'axis',
            axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
            }
        },
        legend: {
            show: true,
            data: ['数量']
        },
        xAxis: {
            data: [],
            axisLabel:{
                interval:0,
                rotate:45,
                marginTop:20,
                textStyle:{
                    color:"#222"
                }},
        },
        yAxis: {
            name: '数量'
        },
        series: [{
            name: '会员数量',
            type: 'bar',
            data: [],
            itemStyle: {
                normal: {
                    // 随机显示
                    //color:function(d){return "#"+Math.floor(Math.random()*(256*256*256-1)).toString(16);}
                    label:{
                        show: true,
                        position:'top',
                        textStyle: {
                            color: '#000'
                        }

                    },
                    // 定制显示（按顺序）
                    color: function(params) {
                        var colorList = ['#C33531','#EFE42A','#64BD3D','#EE9201','#29AAE3', '#B74AE5','#0AAF9F' ];
                        return colorList[params.dataIndex]
                    }
                }
            }
        }]
    });
    numberChange.setOption({
        tooltip: {
            trigger: 'axis'
        },
        legend: {
            data:["游客","普通","白银","黄金","铂金","钻石","联创"]
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        /*    toolbox: {
                feature: {
                    saveAsImage: {}
                }
            },*/
        xAxis: {
            type: 'category',
            boundaryGap: false,
            data: []
        },
        yAxis: {
            type: 'value'
        },
        series: [
            {
                name:'游客',
                type:'line',
                stack: '总量',
                data:[],
                color: "blue"  //折线颜色
            },
            {
                name:'普通',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'白银',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'黄金',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'铂金',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'钻石',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'联创',
                type:'line',
                stack: '总量',
                data:[]
            }
        ]
    });
    goodsDayOut.setOption({
        tooltip: {
            trigger: 'axis',
            axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
            }
        },
        legend: {
            show: true,
            data:["游客","普通","白银","黄金","铂金","钻石","联创"]
        },
        xAxis: {
            data: ["游客","普通","白银","黄金","铂金","钻石","联创"]
        },
        yAxis: {
            name: '数量'
        },
        series: [{
            name: '出货数量',
            type: 'bar',
            data: []
        }]
    });
    goodsDayIn.setOption({
        color: ['#3398DB'],
        tooltip: {
            trigger: 'axis',
            axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
            }
        },
        legend: {
            show: true,
            data:["游客","普通","白银","黄金","铂金","钻石","联创"]
        },
        xAxis: {
            data: ["游客","普通","白银","黄金","铂金","钻石","联创"]
        },
        yAxis: {
            name: '数量'
        },
        series: [{
            name: '出货数量',
            type: 'bar',
            data: []
        }]
    });
    // 周
    memberNumberWeek.setOption({
        tooltip: {
            trigger: 'axis'
        },
        legend: {
            data:["游客","普通","白银","黄金","铂金","钻石","联创"]
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        /*    toolbox: {
                feature: {
                    saveAsImage: {}
                }
            },*/
        xAxis: {
            type: 'category',
            boundaryGap: false,
            data: []
        },
        yAxis: {
            type: 'value'
        },
        series: [
            {
                name:'游客',
                type:'line',
                stack: '总量',
                data:[],
                color: "blue"  //折线颜色
            },
            {
                name:'普通',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'白银',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'黄金',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'铂金',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'钻石',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'联创',
                type:'line',
                stack: '总量',
                data:[]
            }
        ]
    });
    // 天
    memberNumberDay.setOption({
        tooltip: {
            trigger: 'axis'
        },
        legend: {
            data:["游客","普通","白银","黄金","铂金","钻石","联创"]
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        /*    toolbox: {
                feature: {
                    saveAsImage: {}
                }
            },*/
        xAxis: {
            type: 'category',
            boundaryGap: false,
            data: []
        },
        yAxis: {
            type: 'value'
        },
        series: [
            {
                name:'游客',
                type:'line',
                stack: '总量',
                data:[],
                color: "blue"  //折线颜色
            },
            {
                name:'普通',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'白银',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'黄金',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'铂金',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'钻石',
                type:'line',
                stack: '总量',
                data:[]
            },
            {
                name:'联创',
                type:'line',
                stack: '总量',
                data:[]
            }
        ]
    });
    numberChange.showLoading();
    memberNumber.showLoading();
    goodsDayOut.showLoading();
    goodsDayIn.showLoading();
    memberNumberWeek.showLoading();
    memberNumberDay.showLoading();
    var names=[];    //类别数组（实际用来盛放X轴坐标值）
    var nums=[];    //销量数组（实际用来盛放Y坐标值）
    var time=[];   //获取时间
    var numbChange=[];
    var goodsnumber=[];
    var goodsnumberIn=[];

    var week=[];
    var weekNumbers=[];
    var day=[];
    var monthDay=[];
    $.ajax({
        type: "POST", //提交方式
        url: "{:U('dash/getusercount')}",//路径
        data: {},//数据，这里使用的是Json格式进行传输
        dataType: "json",        //返回数据形式为json
        success: function (result) {
            var nameArray = result.level;
            var numsArray = result.level_count;
            var numberChangeDate = result.time;
            var numberChangeArray = result.time_data;
            var goodsNumberArray = result.daliy_out;
            var goodsNumberInArray = result.daliy_in;

            /*    console.log(weekArray);
                console.log(weekNumbersArray);*/
            for (var i = 0; i < nameArray.length; i++) {
                names.push(nameArray[i]);    //挨个取出销量并填入销量数组
            }

            $.each(numsArray, function (name, value) {
                nums.push(value.counts);    //挨个取出销量并填入销量数组
            });

            $.each(numberChangeDate, function (name, value) {
                time.push(value);    //时间
            });

            $.each(numberChangeArray, function (name, value) {
                numbChange.push(value);
            });
            $.each(goodsNumberArray, function (name, value) {
                goodsnumber.push(value);    //每日出货数据
            });
            $.each(goodsNumberInArray, function (name, value) {
                goodsnumberIn.push(value);    //每日进货数据并填入销量数组
            });


            numberChange.hideLoading();
            memberNumber.hideLoading();
            goodsDayOut.hideLoading();
            goodsDayIn.hideLoading();

            memberNumber.setOption({        //加载数据图表
                xAxis: {
                    data: names
                },
                series: [{
                    data: nums
                }]
            });

            // 各个等级7天变动
            numberChange.setOption({
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: time
                },
                series: [
                    {
                        name: '游客',
                        data: numbChange[0],
                        color: "blue"  //折线颜色
                    },
                    {
                        name: '普通',
                        data: numbChange[1]
                    },
                    {
                        name: '白银',
                        data: numbChange[2]
                    },
                    {
                        name: '黄金',
                        data: numbChange[3]
                    },
                    {
                        name: '铂金',
                        data: numbChange[4]
                    },
                    {
                        name: '钻石',
                        data: numbChange[5]
                    },
                    {
                        name: '联创',
                        data: numbChange[6]
                    }
                ]
            });
            // 每个级别每日的出货数据
            goodsDayOut.setOption({        //加载数据图表
                series: [{
                    name: '出货数量',
                    type: 'bar',
                    data: goodsnumber,
                }]
            });
            // 每个级别每日的出货数据
            goodsDayIn.setOption({        //加载数据图表
                series: [{
                    name: '进货数量',
                    type: 'bar',
                    data: goodsnumberIn,
                }]
            });

        }
    });


    $.ajax({
        type: "POST", //提交方式
        url: "{:U('dash/getLevelChange')}",//路径
        data: {},//数据，这里使用的是Json格式进行传输
        dataType: "json",        //返回数据形式为json
        success: function (result) {
            var weekArray =result.weeks;
            var weekNumbersArray=result.week_data;

            $.each(weekArray,function(name,value) {
                week.push(value);    //每日进货数据并填入销量数组
            });
            $.each(weekNumbersArray,function(name,value) {
                weekNumbers.push(value);    //每日进货数据并填入销量数组
            });
            memberNumberWeek.hideLoading();

            // 各个等级周变动
            memberNumberWeek.setOption({
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: week
                },
                series: [
                    {
                        name:'游客',
                        data:weekNumbers[0],
                        color: "blue"  //折线颜色
                    },
                    {
                        name:'普通',
                        data:weekNumbers[1]
                    },
                    {
                        name:'白银',
                        data:weekNumbers[2]
                    },
                    {
                        name:'黄金',
                        data:weekNumbers[3]
                    },
                    {
                        name:'铂金',
                        data:weekNumbers[4]
                    },
                    {
                        name:'钻石',
                        data:weekNumbers[5]
                    },
                    {
                        name:'联创',
                        data:weekNumbers[6]
                    }
                ]
            });

        }

    });


    $.ajax({
        type: "POST", //提交方式
        url: "{:U('dash/getThisMonDay')}",//路径
        data: {},//数据，这里使用的是Json格式进行传输
        dataType: "json",        //返回数据形式为json
        success: function (result) {

            var dayArray=result.month_day;
            var monthDayArray = result.mon_data;

            memberNumberDay.hideLoading();
            // 天
            $.each(dayArray,function(name,value) {
                day.push(value);    //每日进货数据并填入销量数组
            });
            $.each(monthDayArray,function(name,value) {
                monthDay.push(value);    //每日进货数据并填入销量数组
            });

            // 各个等级天变动
            memberNumberDay.setOption({
                xAxis: {
                    axisLabel:{
                        interval:0,
                        rotate:45,
                        marginTop:20,
                        textStyle:{
                            color:"#222"
                        }},
                    type: 'category',
                    boundaryGap: false,
                    data: day
                },
                series: [
                    {
                        name:'游客',
                        data:monthDay[0],
                        color: "blue"  //折线颜色
                    },
                    {
                        name:'普通',
                        data:monthDay[1]
                    },
                    {
                        name:'白银',
                        data:monthDay[2]
                    },
                    {
                        name:'黄金',
                        data:monthDay[3]
                    },
                    {
                        name:'铂金',
                        data:monthDay[4]
                    },
                    {
                        name:'钻石',
                        data:monthDay[5]
                    },
                    {
                        name:'联创',
                        data:monthDay[6]
                    }
                ]
            });

        }

    });

</script>

<script>
    function getmoney(aaa) {
        // alert(aaa);
        $.ajax({
            type : "POST", //提交方式
            url : "{:U('dash/getAboutMoney')}",//路径
            data : {
                "type" :aaa
            },//数据，这里使用的是Json格式进行传输
            success : function(result) {
                var html ='<input type="hidden" id="gettype" value="'+aaa+'">'
                $('#hiddenval') .html(html);
                $('#online_money').text(result.online_money);
                $('#all-money').text(parseFloat(result.online_money)+parseFloat(result.offine_money)+parseFloat(result.jr_money));
                $('#offine_money').text(result.offine_money);
                $('#jr_money').text(result.jr_money);
            }
        });
    }
    function getsale(aaa) {
        // alert(aaa);
        $.ajax({
            type : "POST", //提交方式
            url : "{:U('dash/getOutGood')}",//路径
            data : {
                "type" :aaa
            },//数据，这里使用的是Json格式进行传输
            success : function(result) {
                $('#sale').text(result.outnum);
                $('#salemoney').text(result.paymoney);

            }
        });
    }
</script>

</body>
</html>